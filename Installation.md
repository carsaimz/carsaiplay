# Guia de Instalação do CarsaiPlay

Siga estas instruções para configurar e executar o projeto CarsaiPlay em seu ambiente de desenvolvimento local.

## 1. Pré-requisitos

Antes de começar, certifique-se de que você tem o seguinte instalado:

- **Node.js:** Versão 20.0 ou superior.
- **npm:** (geralmente vem com o Node.js).
- **Conta no Supabase:** Você precisará de uma conta gratuita no [Supabase](https://supabase.com/).

## 2. Configuração do Projeto

### Passo 1: Obtenha o Código-Fonte

Clone este repositório ou faça o download do arquivo ZIP e extraia-o em seu computador.

```bash
# Exemplo com git
git clone [URL_DO_REPOSITORIO]
cd carsaiplay
```

### Passo 2: Instale as Dependências

Execute o seguinte comando no terminal para instalar todas as dependências do projeto:

```bash
npm install
```

## 3. Configuração do Supabase

### Passo 1: Crie um Projeto no Supabase

1.  Acesse seu [Dashboard do Supabase](https://supabase.com/dashboard).
2.  Clique em **"New project"** e siga as instruções para criar um novo projeto. Guarde a senha do seu banco de dados em um lugar seguro.

### Passo 2: Configure as Variáveis de Ambiente

No arquivo `src/lib/supabase.js`, você encontrará as variáveis para a URL e a chave anônima (anon key) do Supabase. Você precisa substituir os valores existentes pelos do seu projeto.

1.  No seu projeto Supabase, vá para **Project Settings** (ícone de engrenagem) > **API**.
2.  Encontre a **Project URL** e a **Project API Keys** (use a chave `anon` `public`).
3.  Abra o arquivo `src/lib/supabase.js` e atualize as constantes:

```javascript
// src/lib/supabase.js

import { createClient } from '@supabase/supabase-js';

// SUBSTITUA PELOS SEUS DADOS
const supabaseUrl = 'URL_DO_SEU_PROJETO_SUPABASE';
const supabaseAnonKey = 'SUA_CHAVE_ANON_PUBLICA';

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

### Passo 3: Configure o Banco de Dados

Para que a aplicação funcione, você precisa criar as tabelas e funções no banco de dados do seu projeto Supabase.

1.  No seu projeto Supabase, vá para o **SQL Editor** (ícone de banco de dados).
2.  Clique em **"+ New query"**.
3.  Copie e cole o conteúdo do arquivo `schema.sql` (disponível abaixo) no editor e clique em **"RUN"**.

**schema.sql:**
```sql
-- Criar tabela de categorias
CREATE TABLE public.categories (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name text NOT NULL,
    created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- Criar tabela de conteúdo
CREATE TABLE public.content (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title text NOT NULL,
    type text NOT NULL,
    category_id bigint REFERENCES public.categories(id),
    year integer,
    rating numeric,
    synopsis text,
    poster text,
    backdrop text,
    embeds jsonb,
    downloads jsonb,
    views integer DEFAULT 0,
    featured boolean DEFAULT false,
    created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- Criar tabela de perfis de usuário
CREATE TABLE public.profiles (
    id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    name text,
    email text,
    is_admin boolean DEFAULT false,
    favorites jsonb DEFAULT '[]'::jsonb,
    watch_later jsonb DEFAULT '[]'::jsonb,
    watched jsonb DEFAULT '[]'::jsonb,
    created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- Criar tabela de comentários
CREATE TABLE public.comments (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    content_id bigint NOT NULL REFERENCES public.content(id) ON DELETE CASCADE,
    user_id uuid NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
    text text NOT NULL,
    rating integer,
    created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- Função para criar um perfil quando um novo usuário se registra
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path TO 'public'
AS $$
BEGIN
  INSERT INTO public.profiles (id, email, name)
  VALUES (new.id, new.email, new.raw_user_meta_data->>'name');
  RETURN new;
END;
$$;

-- Trigger para executar a função handle_new_user
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();

-- Função para incrementar visualizações
CREATE OR REPLACE FUNCTION public.increment_views(content_id bigint)
RETURNS void
LANGUAGE plpgsql
AS $$
BEGIN
  UPDATE content
  SET views = views + 1
  WHERE id = content_id;
END;
$$;

-- Políticas de Acesso (RLS)
-- Habilitar RLS para todas as tabelas
ALTER TABLE public.categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.content ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.comments ENABLE ROW LEVEL SECURITY;

-- Políticas para 'categories'
CREATE POLICY "Allow all authenticated users to read categories" ON public.categories FOR SELECT TO authenticated USING (true);
CREATE POLICY "Allow admins to manage categories" ON public.categories FOR ALL TO authenticated USING ((SELECT is_admin FROM public.profiles WHERE id = auth.uid())) WITH CHECK ((SELECT is_admin FROM public.profiles WHERE id = auth.uid()));

-- Políticas para 'content'
CREATE POLICY "Allow all authenticated users to read content" ON public.content FOR SELECT TO authenticated USING (true);
CREATE POLICY "Allow admins to manage content" ON public.content FOR ALL TO authenticated USING ((SELECT is_admin FROM public.profiles WHERE id = auth.uid())) WITH CHECK ((SELECT is_admin FROM public.profiles WHERE id = auth.uid()));

-- Políticas para 'profiles'
CREATE POLICY "Allow users to view their own profile" ON public.profiles FOR SELECT TO authenticated USING (auth.uid() = id);
CREATE POLICY "Allow users to update their own profile" ON public.profiles FOR UPDATE TO authenticated USING (auth.uid() = id) WITH CHECK (auth.uid() = id);
CREATE POLICY "Allow admins to view all profiles" ON public.profiles FOR SELECT TO authenticated USING ((SELECT is_admin FROM public.profiles WHERE id = auth.uid()));

-- Políticas para 'comments'
CREATE POLICY "Allow all authenticated users to read comments" ON public.comments FOR SELECT TO authenticated USING (true);
CREATE POLICY "Allow users to insert their own comments" ON public.comments FOR INSERT TO authenticated WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Allow users to delete their own comments" ON public.comments FOR DELETE TO authenticated USING (auth.uid() = user_id);
CREATE POLICY "Allow admins to manage all comments" ON public.comments FOR ALL TO authenticated USING ((SELECT is_admin FROM public.profiles WHERE id = auth.uid())) WITH CHECK ((SELECT is_admin FROM public.profiles WHERE id = auth.uid()));
```

## 4. Executando a Aplicação

Após a instalação e configuração, inicie o servidor de desenvolvimento:

```bash
npm run dev
```

A aplicação estará disponível em [http://localhost:5173](http://localhost:5173) (ou em outra porta, se a 5173 estiver em uso).

## 5. Build para Produção

Para criar uma versão otimizada para produção, execute:

```bash
npm run build
```

Os arquivos prontos para o deploy estarão na pasta `dist/`.
